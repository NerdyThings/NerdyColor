"use strict";
/// <reference path="types.d.ts" />
const nerdy_color_core_alpha_1 = require("./nerdy-color-core-alpha"); // ObserverArray, ParsableValue, ParsedValue
const parseRGB = nerdy_color_core_alpha_1.Parse.rgb;
///<amd-module name="NerdyColor"/>
var NerdyColor;
(function (NerdyColor) {
    class Utils {
    }
    Utils.Parse = nerdy_color_core_alpha_1.Parse;
    Utils.ObservableObject = nerdy_color_core_alpha_1.ObservableObject;
    Utils.observersOf = nerdy_color_core_alpha_1.Oberservables.observersOf;
    NerdyColor.Utils = Utils;
    class Color extends nerdy_color_core_alpha_1.ObservableObject {
        constructor({ r, g, b, alpha = 1.0, components = [0, 0, 0], componentNames = ['r', 'g', 'b'] } = {}) {
            super();
            // console.log('new NerdyColor.Color', { r, g, b, alpha, components, componentNames, mode: (componentNames.length ? componentNames : componentNames = (componentNames = ['r', 'g', 'b'])).join("").toLowerCase(), arguments });
            const fail = (reason = 'Color parameters cannot be parsed!') => { throw 'Cannot create color: ' + reason; };
            // Parse colorSpecification: string (Only rgb() and rgba() css syntax supported)
            if (nerdy_color_core_alpha_1.isString(arguments[0])) {
                ((colorString) => {
                    var matchedString, matchedComponents;
                    if ((/\#[0-9A-F]{3,6}/i).test(colorString)) {
                        fail('Hex color parameters cannot be parsed yet!');
                    }
                    else if ((/rgba?\s*\(\s*\d+\s*\,\s*\d+\s*\,\s*\d+\s*[\,\)]/).test(colorString)) {
                        [matchedString] = colorString.match(/rgba?\s*\(.*?\)/i);
                        matchedComponents = colorString.match(/\b([01]?\.\d+|1|0|\d+)\b/g);
                        if (matchedComponents.length >= 3) {
                            components = [parseRGB(matchedComponents[0]) || 0, parseRGB(matchedComponents[1]) || 0, parseRGB(matchedComponents[2]) || 0];
                            componentNames = ['r', 'g', 'b'];
                        }
                        else
                            fail('RGB color parameters cannot be parsed: ' + matchedString);
                        if (matchedComponents.length >= 4)
                            alpha = Math.min(Math.max(0, parseFloat(matchedComponents[3])), 1);
                    } // other cases to be added later
                })(arguments[0]);
            }
            // Determine Mode (Only rgb supported so far)
            this.mode = (componentNames.length ? componentNames : componentNames = (componentNames = ['r', 'g', 'b'])).join("").toLowerCase();
            if (this.mode === 'rgb')
                components = [(nerdy_color_core_alpha_1.isNumber(r) ? r : components[0] || 0), (nerdy_color_core_alpha_1.isNumber(g) ? g : components[1] || 0), (nerdy_color_core_alpha_1.isNumber(b) ? b : components[2] || 0)];
            this.components = components, this.componentNames = componentNames, this.alpha = alpha;
        }
        getComponent(id) {
            let index = parseInt(id);
            if (isNaN(index) && nerdy_color_core_alpha_1.isString(id))
                index = (this.componentNames || ['r', 'g', 'b']).indexOf(id.toLowerCase());
            return this.components[index];
        }
        getComponents() {
            return this.components;
        }
        setComponents({ r = this.getComponent('r'), g = this.getComponent('g'), b = this.getComponent('b') }) {
            r = nerdy_color_core_alpha_1.Parse.rgb(r), g = nerdy_color_core_alpha_1.Parse.rgb(g), b = nerdy_color_core_alpha_1.Parse.rgb(b);
            if (this.components[0] === r && this.components[2] === g && this.components[1] === b)
                return false;
            /* Changed */ this.components = [r, g, b], this.publish(this, 'components-changed');
            return true;
        }
    }
    NerdyColor.Color = Color;
    // export declare interface ColorConstructor {
    //     new (colorSpecification?: string|ColorConstructorParameters) : Color;
    // }
})(NerdyColor = exports.NerdyColor || (exports.NerdyColor = {}));
// export default NerdyColor; 
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmVyZHktY29sb3ItYWxwaGEuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJuZXJkeS1jb2xvci1hbHBoYS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsbUNBQW1DO0FBQ25DLHFFQUEwSSxDQUFDLDRDQUE0QztBQUV2TCxNQUFNLFFBQVEsR0FBRyw4QkFBSyxDQUFDLEdBQUcsQ0FBQztBQUUzQixrQ0FBa0M7QUFDbEMsSUFBYyxVQUFVLENBa0V2QjtBQWxFRCxXQUFjLFVBQVU7SUFFcEI7O0lBQ1csV0FBSyxHQUFHLDhCQUFLLENBQUM7SUFDZCxzQkFBZ0IsR0FBRyx5Q0FBZ0IsQ0FBQztJQUNwQyxpQkFBVyxHQUFHLHNDQUFhLENBQUMsV0FBVyxDQUFDO0lBSHRDLGdCQUFLLFFBSWpCLENBQUE7SUFFRCxXQUFtQixTQUFRLHlDQUFnQjtRQU92QyxZQUFZLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBSyxHQUFHLEdBQUcsRUFBRSxVQUFVLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLGNBQWMsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLEtBQWlDLEVBQUU7WUFDM0gsS0FBSyxFQUFFLENBQUM7WUFDUiwrTkFBK047WUFDL04sTUFBTSxJQUFJLEdBQUcsQ0FBQyxNQUFNLEdBQUcsb0NBQW9DLE9BQU8sTUFBTSx1QkFBdUIsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFFM0csZ0ZBQWdGO1lBQ2hGLEVBQUUsQ0FBQyxDQUFDLGlDQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN6QixDQUFDLENBQUMsV0FBbUI7b0JBQ2pCLElBQUksYUFBcUIsRUFBRSxpQkFBMkIsQ0FBQztvQkFDdkQsRUFBRSxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ3pDLElBQUksQ0FBQyw0Q0FBNEMsQ0FBQyxDQUFDO29CQUN2RCxDQUFDO29CQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLGlEQUFpRCxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDL0UsQ0FBQyxhQUFhLENBQUMsR0FBYSxXQUFXLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUM7d0JBQ2xFLGlCQUFpQixHQUFhLFdBQVcsQ0FBQyxLQUFLLENBQUMsMkJBQTJCLENBQUMsQ0FBQzt3QkFDN0UsRUFBRSxDQUFDLENBQUMsaUJBQWlCLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7NEJBQ2hDLFVBQVUsR0FBRyxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxRQUFRLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsUUFBUSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7NEJBQzdILGNBQWMsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7d0JBQ3JDLENBQUM7d0JBQUMsSUFBSTs0QkFBQyxJQUFJLENBQUMseUNBQXlDLEdBQUcsYUFBYSxDQUFDLENBQUM7d0JBQ3ZFLEVBQUUsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUM7NEJBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsVUFBVSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztvQkFDMUcsQ0FBQyxDQUFDLGdDQUFnQztnQkFDdEMsQ0FBQyxDQUFDLENBQVMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDN0IsQ0FBQztZQUVELDZDQUE2QztZQUM3QyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsY0FBYyxDQUFDLE1BQU0sR0FBRyxjQUFjLEdBQUcsY0FBYyxHQUFHLENBQUMsY0FBYyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2xJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssS0FBSyxDQUFDO2dCQUFDLFVBQVUsR0FBYSxDQUFFLENBQUMsaUNBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsaUNBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsaUNBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFFLENBQUM7WUFDM0ssSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLEVBQUUsSUFBSSxDQUFDLGNBQWMsR0FBRyxjQUFjLEVBQUUsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDM0YsQ0FBQztRQUVELFlBQVksQ0FBQyxFQUFtQjtZQUM1QixJQUFJLEtBQUssR0FBVyxRQUFRLENBQVUsRUFBRyxDQUFDLENBQUM7WUFDM0MsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLGlDQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQUMsS0FBSyxHQUFHLENBQUMsSUFBSSxDQUFDLGNBQWMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQVUsRUFBRyxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7WUFDdkgsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbEMsQ0FBQztRQUVELGFBQWE7WUFDVCxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQUMzQixDQUFDO1FBRUQsYUFBYSxDQUFDLEVBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLEVBQTREO1lBQ3pKLENBQUMsR0FBRyw4QkFBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsOEJBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLDhCQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3JELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7WUFDbkcsYUFBYSxDQUFDLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLG9CQUFvQixDQUFDLENBQUM7WUFDcEYsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNoQixDQUFDO0tBRUo7SUFyRFksZ0JBQUssUUFxRGpCLENBQUE7SUFFRCw4Q0FBOEM7SUFDOUMsNEVBQTRFO0lBQzVFLElBQUk7QUFDUixDQUFDLEVBbEVhLFVBQVUsR0FBVixrQkFBVSxLQUFWLGtCQUFVLFFBa0V2QjtBQWlCRCw2QkFBNkIiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwidHlwZXMuZC50c1wiIC8+XG5pbXBvcnQgeyBpc1N0cmluZywgaXNOdW1iZXIsIGlzRnVuY3Rpb24sIE9ic2VydmFibGVPYmplY3QsIG9ic2VydmVyc09mLCBPQlNFUlZFUlMsIFBhcnNlLCBPYmVyc2VydmFibGVzIH0gZnJvbSAnLi9uZXJkeS1jb2xvci1jb3JlLWFscGhhJzsgLy8gT2JzZXJ2ZXJBcnJheSwgUGFyc2FibGVWYWx1ZSwgUGFyc2VkVmFsdWVcblxuY29uc3QgcGFyc2VSR0IgPSBQYXJzZS5yZ2I7XG5cbi8vLzxhbWQtbW9kdWxlIG5hbWU9XCJOZXJkeUNvbG9yXCIvPlxuZXhwb3J0IG1vZHVsZSBOZXJkeUNvbG9yIHtcblxuICAgIGV4cG9ydCBjbGFzcyBVdGlscyB7XG4gICAgICAgIHN0YXRpYyBQYXJzZSA9IFBhcnNlO1xuICAgICAgICBzdGF0aWMgT2JzZXJ2YWJsZU9iamVjdCA9IE9ic2VydmFibGVPYmplY3Q7XG4gICAgICAgIHN0YXRpYyBvYnNlcnZlcnNPZiA9IE9iZXJzZXJ2YWJsZXMub2JzZXJ2ZXJzT2Y7XG4gICAgfVxuXG4gICAgZXhwb3J0IGNsYXNzIENvbG9yIGV4dGVuZHMgT2JzZXJ2YWJsZU9iamVjdCB7XG4gICAgICAgIHB1YmxpYyBjb21wb25lbnRzOiBQYXJzZWRWYWx1ZVtdO1xuICAgICAgICBwdWJsaWMgY29tcG9uZW50TmFtZXM6IHN0cmluZ1tdO1xuICAgICAgICBwdWJsaWMgYWxwaGE6IG51bWJlcjtcbiAgICAgICAgcHVibGljIG1vZGU6IHN0cmluZztcblxuICAgICAgICBjb25zdHJ1Y3Rvcihjb2xvclNwZWNpZmljYXRpb24/OiBDb2xvckNvbnN0cnVjdG9yUGFyYW1ldGVyc3xzdHJpbmd8dW5kZWZpbmVkKTtcbiAgICAgICAgY29uc3RydWN0b3IoeyByLCBnLCBiLCBhbHBoYSA9IDEuMCwgY29tcG9uZW50cyA9IFswLCAwLCAwXSwgY29tcG9uZW50TmFtZXMgPSBbJ3InLCAnZycsICdiJ10gfTogQ29sb3JDb25zdHJ1Y3RvclBhcmFtZXRlcnMgPSB7fSkge1xuICAgICAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCduZXcgTmVyZHlDb2xvci5Db2xvcicsIHsgciwgZywgYiwgYWxwaGEsIGNvbXBvbmVudHMsIGNvbXBvbmVudE5hbWVzLCBtb2RlOiAoY29tcG9uZW50TmFtZXMubGVuZ3RoID8gY29tcG9uZW50TmFtZXMgOiBjb21wb25lbnROYW1lcyA9IChjb21wb25lbnROYW1lcyA9IFsncicsICdnJywgJ2InXSkpLmpvaW4oXCJcIikudG9Mb3dlckNhc2UoKSwgYXJndW1lbnRzIH0pO1xuICAgICAgICAgICAgY29uc3QgZmFpbCA9IChyZWFzb24gPSAnQ29sb3IgcGFyYW1ldGVycyBjYW5ub3QgYmUgcGFyc2VkIScpID0+IHsgdGhyb3cgJ0Nhbm5vdCBjcmVhdGUgY29sb3I6ICcgKyByZWFzb247IH1cblxuICAgICAgICAgICAgLy8gUGFyc2UgY29sb3JTcGVjaWZpY2F0aW9uOiBzdHJpbmcgKE9ubHkgcmdiKCkgYW5kIHJnYmEoKSBjc3Mgc3ludGF4IHN1cHBvcnRlZClcbiAgICAgICAgICAgIGlmIChpc1N0cmluZyhhcmd1bWVudHNbMF0pKSB7IFxuICAgICAgICAgICAgICAgICgoY29sb3JTdHJpbmc6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2hlZFN0cmluZzogc3RyaW5nLCBtYXRjaGVkQ29tcG9uZW50czogc3RyaW5nW107XG4gICAgICAgICAgICAgICAgICAgIGlmICgoL1xcI1swLTlBLUZdezMsNn0vaSkudGVzdChjb2xvclN0cmluZykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWwoJ0hleCBjb2xvciBwYXJhbWV0ZXJzIGNhbm5vdCBiZSBwYXJzZWQgeWV0IScpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCgvcmdiYT9cXHMqXFwoXFxzKlxcZCtcXHMqXFwsXFxzKlxcZCtcXHMqXFwsXFxzKlxcZCtcXHMqW1xcLFxcKV0vKS50ZXN0KGNvbG9yU3RyaW5nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgW21hdGNoZWRTdHJpbmddID0gPHN0cmluZ1tdPmNvbG9yU3RyaW5nLm1hdGNoKC9yZ2JhP1xccypcXCguKj9cXCkvaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVkQ29tcG9uZW50cyA9IDxzdHJpbmdbXT5jb2xvclN0cmluZy5tYXRjaCgvXFxiKFswMV0/XFwuXFxkK3wxfDB8XFxkKylcXGIvZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2hlZENvbXBvbmVudHMubGVuZ3RoID49IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRzID0gW3BhcnNlUkdCKG1hdGNoZWRDb21wb25lbnRzWzBdKSB8fCAwLCBwYXJzZVJHQihtYXRjaGVkQ29tcG9uZW50c1sxXSkgfHwgMCwgcGFyc2VSR0IobWF0Y2hlZENvbXBvbmVudHNbMl0pIHx8IDBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudE5hbWVzID0gWydyJywgJ2cnLCAnYiddO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGZhaWwoJ1JHQiBjb2xvciBwYXJhbWV0ZXJzIGNhbm5vdCBiZSBwYXJzZWQ6ICcgKyBtYXRjaGVkU3RyaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGVkQ29tcG9uZW50cy5sZW5ndGggPj0gNCkgYWxwaGEgPSBNYXRoLm1pbihNYXRoLm1heCgwLCBwYXJzZUZsb2F0KG1hdGNoZWRDb21wb25lbnRzWzNdKSksIDEpO1xuICAgICAgICAgICAgICAgICAgICB9IC8vIG90aGVyIGNhc2VzIHRvIGJlIGFkZGVkIGxhdGVyXG4gICAgICAgICAgICAgICAgfSkoPHN0cmluZz5hcmd1bWVudHNbMF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBEZXRlcm1pbmUgTW9kZSAoT25seSByZ2Igc3VwcG9ydGVkIHNvIGZhcilcbiAgICAgICAgICAgIHRoaXMubW9kZSA9IChjb21wb25lbnROYW1lcy5sZW5ndGggPyBjb21wb25lbnROYW1lcyA6IGNvbXBvbmVudE5hbWVzID0gKGNvbXBvbmVudE5hbWVzID0gWydyJywgJ2cnLCAnYiddKSkuam9pbihcIlwiKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ3JnYicpIGNvbXBvbmVudHMgPSA8bnVtYmVyW10+WyAoaXNOdW1iZXIocikgPyByIDogY29tcG9uZW50c1swXSB8fCAwKSwgKGlzTnVtYmVyKGcpID8gZyA6IGNvbXBvbmVudHNbMV0gfHwgMCksIChpc051bWJlcihiKSA/IGIgOiBjb21wb25lbnRzWzJdIHx8IDApIF07XG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudHMgPSBjb21wb25lbnRzLCB0aGlzLmNvbXBvbmVudE5hbWVzID0gY29tcG9uZW50TmFtZXMsIHRoaXMuYWxwaGEgPSBhbHBoYTtcbiAgICAgICAgfVxuXG4gICAgICAgIGdldENvbXBvbmVudChpZDogc3RyaW5nIHwgbnVtYmVyKTogUGFyc2VkVmFsdWUge1xuICAgICAgICAgICAgbGV0IGluZGV4OiBudW1iZXIgPSBwYXJzZUludCgoPHN0cmluZz5pZCkpO1xuICAgICAgICAgICAgaWYgKGlzTmFOKGluZGV4KSAmJiBpc1N0cmluZyhpZCkpIGluZGV4ID0gKHRoaXMuY29tcG9uZW50TmFtZXMgfHwgWydyJywgJ2cnLCAnYiddKS5pbmRleE9mKCg8c3RyaW5nPmlkKS50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudHNbaW5kZXhdO1xuICAgICAgICB9XG5cbiAgICAgICAgZ2V0Q29tcG9uZW50cygpOiBQYXJzZWRWYWx1ZVtdIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudHM7XG4gICAgICAgIH1cblxuICAgICAgICBzZXRDb21wb25lbnRzKHtyID0gdGhpcy5nZXRDb21wb25lbnQoJ3InKSwgZyA9IHRoaXMuZ2V0Q29tcG9uZW50KCdnJyksIGIgPSB0aGlzLmdldENvbXBvbmVudCgnYicpIH06IHsgcjogUGFyc2FibGVWYWx1ZSwgZzogUGFyc2FibGVWYWx1ZSwgYjogUGFyc2FibGVWYWx1ZSB9KSB7XG4gICAgICAgICAgICByID0gUGFyc2UucmdiKHIpLCBnID0gUGFyc2UucmdiKGcpLCBiID0gUGFyc2UucmdiKGIpO1xuICAgICAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50c1swXSA9PT0gciAmJiB0aGlzLmNvbXBvbmVudHNbMl0gPT09IGcgJiYgdGhpcy5jb21wb25lbnRzWzFdID09PSBiKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAvKiBDaGFuZ2VkICovIHRoaXMuY29tcG9uZW50cyA9IFtyLCBnLCBiXSwgdGhpcy5wdWJsaXNoKHRoaXMsICdjb21wb25lbnRzLWNoYW5nZWQnKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICAvLyBleHBvcnQgZGVjbGFyZSBpbnRlcmZhY2UgQ29sb3JDb25zdHJ1Y3RvciB7XG4gICAgLy8gICAgIG5ldyAoY29sb3JTcGVjaWZpY2F0aW9uPzogc3RyaW5nfENvbG9yQ29uc3RydWN0b3JQYXJhbWV0ZXJzKSA6IENvbG9yO1xuICAgIC8vIH1cbn1cblxuLy8gZXhwb3J0IGRlY2xhcmUgdHlwZSBOZXJkeUNvbG9yTW9kdWxlID0ge1xuLy8gICAgIENvbG9yOiBOZXJkeUNvbG9yLkNvbG9yO1xuLy8gICAgIFV0aWw6IE5lcmR5Q29sb3IuVXRpbHM7XG4vLyB9XG5cbi8vIGV4cG9ydCBkZWNsYXJlIGludGVyZmFjZSBOZXJkeUNvbG9yTW9kdWxlQ29uc3RydWN0b3Ige1xuLy8gICAgIENvbG9yOiBOZXJkeUNvbG9yLkNvbG9yO1xuLy8gICAgIFV0aWw6IE5lcmR5Q29sb3IuVXRpbHM7XG4vLyB9XG5cbmV4cG9ydCBkZWNsYXJlIHR5cGUgTmVyZHlDb2xvck1vZHVsZSA9IHsgQ29sb3I6IG5ldyAoY29sb3JTcGVjaWZpY2F0aW9uPzogQ29sb3JDb25zdHJ1Y3RvclBhcmFtZXRlcnN8c3RyaW5nfHVuZGVmaW5lZCkgPT4gTmVyZHlDb2xvci5Db2xvciwgVXRpbHM6IE5lcmR5Q29sb3IuVXRpbHMgfTtcbmV4cG9ydCBkZWNsYXJlIHR5cGUgTmVyZHlDb2xvckV4cG9ydHMgPSB7IGRlZmF1bHQ6TmVyZHlDb2xvck1vZHVsZSB9O1xuXG5cblxuLy8gZXhwb3J0IGRlZmF1bHQgTmVyZHlDb2xvcjsiXX0=