define(["require", "exports", './nerdy-color-core-alpha'], function (require, exports, nerdy_color_core_alpha_1) {
    "use strict";
    const parseRGB = nerdy_color_core_alpha_1.Parse.rgb;
    ///<amd-module name="NerdyColor"/>
    var NerdyColor;
    (function (NerdyColor) {
        class Utils {
        }
        Utils.Parse = nerdy_color_core_alpha_1.Parse;
        Utils.ObservableObject = nerdy_color_core_alpha_1.ObservableObject;
        Utils.observersOf = nerdy_color_core_alpha_1.Oberservables.observersOf;
        NerdyColor.Utils = Utils;
        class Color extends nerdy_color_core_alpha_1.ObservableObject {
            constructor({ r, g, b, alpha = 1.0, components = [0, 0, 0], componentNames = ['r', 'g', 'b'] } = {}) {
                super();
                // console.log('new NerdyColor.Color', { r, g, b, alpha, components, componentNames, mode: (componentNames.length ? componentNames : componentNames = (componentNames = ['r', 'g', 'b'])).join("").toLowerCase(), arguments });
                const fail = (reason = 'Color parameters cannot be parsed!') => { throw 'Cannot create color: ' + reason; };
                // Parse colorSpecification: string (Only rgb() and rgba() css syntax supported)
                if (nerdy_color_core_alpha_1.isString(arguments[0])) {
                    ((colorString) => {
                        var matchedString, matchedComponents;
                        if ((/\#[0-9A-F]{3,6}/i).test(colorString)) {
                            fail('Hex color parameters cannot be parsed yet!');
                        }
                        else if ((/rgba?\s*\(\s*\d+\s*\,\s*\d+\s*\,\s*\d+\s*[\,\)]/).test(colorString)) {
                            [matchedString] = colorString.match(/rgba?\s*\(.*?\)/i);
                            matchedComponents = colorString.match(/\b([01]?\.\d+|1|0|\d+)\b/g);
                            if (matchedComponents.length >= 3) {
                                components = [parseRGB(matchedComponents[0]) || 0, parseRGB(matchedComponents[1]) || 0, parseRGB(matchedComponents[2]) || 0];
                                componentNames = ['r', 'g', 'b'];
                            }
                            else
                                fail('RGB color parameters cannot be parsed: ' + matchedString);
                            if (matchedComponents.length >= 4)
                                alpha = Math.min(Math.max(0, parseFloat(matchedComponents[3])), 1);
                        } // other cases to be added later
                    })(arguments[0]);
                }
                // Determine Mode (Only rgb supported so far)
                this.mode = (componentNames.length ? componentNames : componentNames = (componentNames = ['r', 'g', 'b'])).join("").toLowerCase();
                if (this.mode === 'rgb')
                    components = [(nerdy_color_core_alpha_1.isNumber(r) ? r : components[0] || 0), (nerdy_color_core_alpha_1.isNumber(g) ? g : components[1] || 0), (nerdy_color_core_alpha_1.isNumber(b) ? b : components[2] || 0)];
                this.components = components, this.componentNames = componentNames, this.alpha = alpha;
            }
            getComponent(id) {
                let index = parseInt(id);
                if (isNaN(index) && nerdy_color_core_alpha_1.isString(id))
                    index = (this.componentNames || ['r', 'g', 'b']).indexOf(id.toLowerCase());
                return this.components[index];
            }
            getComponents() {
                return this.components;
            }
            setComponents({ r = this.getComponent('r'), g = this.getComponent('g'), b = this.getComponent('b') }) {
                r = nerdy_color_core_alpha_1.Parse.rgb(r), g = nerdy_color_core_alpha_1.Parse.rgb(g), b = nerdy_color_core_alpha_1.Parse.rgb(b);
                if (this.components[0] === r && this.components[2] === g && this.components[1] === b)
                    return false;
                /* Changed */ this.components = [r, g, b], this.publish(this, 'components-changed');
                return true;
            }
        }
        NerdyColor.Color = Color;
    })(NerdyColor = exports.NerdyColor || (exports.NerdyColor = {}));
});
// export default NerdyColor; 
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmVyZHktY29sb3ItYWxwaGEuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJuZXJkeS1jb2xvci1hbHBoYS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztJQUdBLE1BQU0sUUFBUSxHQUFHLDhCQUFLLENBQUMsR0FBRyxDQUFDO0lBRTNCLGtDQUFrQztJQUNsQyxJQUFjLFVBQVUsQ0FrRXZCO0lBbEVELFdBQWMsVUFBVSxFQUFDLENBQUM7UUFFdEI7UUFJQSxDQUFDO1FBSFUsV0FBSyxHQUFHLDhCQUFLLENBQUM7UUFDZCxzQkFBZ0IsR0FBRyx5Q0FBZ0IsQ0FBQztRQUNwQyxpQkFBVyxHQUFHLHNDQUFhLENBQUMsV0FBVyxDQUFDO1FBSHRDLGdCQUFLLFFBSWpCLENBQUE7UUFFRCxvQkFBMkIseUNBQWdCO1lBT3ZDLFlBQVksRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxLQUFLLEdBQUcsR0FBRyxFQUFFLFVBQVUsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsY0FBYyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxHQUErQixFQUFFO2dCQUMzSCxPQUFPLENBQUM7Z0JBQ1IsK05BQStOO2dCQUMvTixNQUFNLElBQUksR0FBRyxDQUFDLE1BQU0sR0FBRyxvQ0FBb0MsT0FBTyxNQUFNLHVCQUF1QixHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQTtnQkFFM0csZ0ZBQWdGO2dCQUNoRixFQUFFLENBQUMsQ0FBQyxpQ0FBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDekIsQ0FBQyxDQUFDLFdBQW1CO3dCQUNqQixJQUFJLGFBQXFCLEVBQUUsaUJBQTJCLENBQUM7d0JBQ3ZELEVBQUUsQ0FBQyxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUN6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cG9ydCB7IGlzU3RyaW5nLCBpc051bWJlciwgaXNGdW5jdGlvbiwgT2JzZXJ2YWJsZU9iamVjdCwgb2JzZXJ2ZXJzT2YsIE9CU0VSVkVSUywgUGFyc2UsIE9iZXJzZXJ2YWJsZXMgfSBmcm9tICcuL25lcmR5LWNvbG9yLWNvcmUtYWxwaGEnOyAvLyBPYnNlcnZlckFycmF5LCBQYXJzYWJsZVZhbHVlLCBQYXJzZWRWYWx1ZVxuXG5jb25zdCBwYXJzZVJHQiA9IFBhcnNlLnJnYjtcblxuLy8vPGFtZC1tb2R1bGUgbmFtZT1cIk5lcmR5Q29sb3JcIi8+XG5leHBvcnQgbW9kdWxlIE5lcmR5Q29sb3Ige1xuXG4gICAgZXhwb3J0IGNsYXNzIFV0aWxzIHtcbiAgICAgICAgc3RhdGljIFBhcnNlID0gUGFyc2U7XG4gICAgICAgIHN0YXRpYyBPYnNlcnZhYmxlT2JqZWN0ID0gT2JzZXJ2YWJsZU9iamVjdDtcbiAgICAgICAgc3RhdGljIG9ic2VydmVyc09mID0gT2JlcnNlcnZhYmxlcy5vYnNlcnZlcnNPZjtcbiAgICB9XG5cbiAgICBleHBvcnQgY2xhc3MgQ29sb3IgZXh0ZW5kcyBPYnNlcnZhYmxlT2JqZWN0IHtcbiAgICAgICAgcHVibGljIGNvbXBvbmVudHM6IFBhcnNlZFZhbHVlW107XG4gICAgICAgIHB1YmxpYyBjb21wb25lbnROYW1lczogc3RyaW5nW107XG4gICAgICAgIHB1YmxpYyBhbHBoYTogbnVtYmVyO1xuICAgICAgICBwdWJsaWMgbW9kZTogc3RyaW5nO1xuXG4gICAgICAgIGNvbnN0cnVjdG9yKGNvbG9yU3BlY2lmaWNhdGlvbj86IENvbG9yQ29uc3RydWN0b3JQYXJhbWV0ZXJzfHN0cmluZ3x1bmRlZmluZWQpO1xuICAgICAgICBjb25zdHJ1Y3Rvcih7IHIsIGcsIGIsIGFscGhhID0gMS4wLCBjb21wb25lbnRzID0gWzAsIDAsIDBdLCBjb21wb25lbnROYW1lcyA9IFsncicsICdnJywgJ2InXSB9OiBDb2xvckNvbnN0cnVjdG9yUGFyYW1ldGVycyA9IHt9KSB7XG4gICAgICAgICAgICBzdXBlcigpO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ25ldyBOZXJkeUNvbG9yLkNvbG9yJywgeyByLCBnLCBiLCBhbHBoYSwgY29tcG9uZW50cywgY29tcG9uZW50TmFtZXMsIG1vZGU6IChjb21wb25lbnROYW1lcy5sZW5ndGggPyBjb21wb25lbnROYW1lcyA6IGNvbXBvbmVudE5hbWVzID0gKGNvbXBvbmVudE5hbWVzID0gWydyJywgJ2cnLCAnYiddKSkuam9pbihcIlwiKS50b0xvd2VyQ2FzZSgpLCBhcmd1bWVudHMgfSk7XG4gICAgICAgICAgICBjb25zdCBmYWlsID0gKHJlYXNvbiA9ICdDb2xvciBwYXJhbWV0ZXJzIGNhbm5vdCBiZSBwYXJzZWQhJykgPT4geyB0aHJvdyAnQ2Fubm90IGNyZWF0ZSBjb2xvcjogJyArIHJlYXNvbjsgfVxuXG4gICAgICAgICAgICAvLyBQYXJzZSBjb2xvclNwZWNpZmljYXRpb246IHN0cmluZyAoT25seSByZ2IoKSBhbmQgcmdiYSgpIGNzcyBzeW50YXggc3VwcG9ydGVkKVxuICAgICAgICAgICAgaWYgKGlzU3RyaW5nKGFyZ3VtZW50c1swXSkpIHsgXG4gICAgICAgICAgICAgICAgKChjb2xvclN0cmluZzogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXRjaGVkU3RyaW5nOiBzdHJpbmcsIG1hdGNoZWRDb21wb25lbnRzOiBzdHJpbmdbXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCgvXFwjWzAtOUEtRl17Myw2fS9pKS50ZXN0KGNvbG9yU3RyaW5nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbCgnSGV4IGNvbG9yIHBhcmFtZXRlcnMgY2Fubm90IGJlIHBhcnNlZCB5ZXQhJyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKC9yZ2JhP1xccypcXChcXHMqXFxkK1xccypcXCxcXHMqXFxkK1xccypcXCxcXHMqXFxkK1xccypbXFwsXFwpXS8pLnRlc3QoY29sb3JTdHJpbmcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBbbWF0Y2hlZFN0cmluZ10gPSA8c3RyaW5nW10+Y29sb3JTdHJpbmcubWF0Y2goL3JnYmE/XFxzKlxcKC4qP1xcKS9pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZWRDb21wb25lbnRzID0gPHN0cmluZ1tdPmNvbG9yU3RyaW5nLm1hdGNoKC9cXGIoWzAxXT9cXC5cXGQrfDF8MHxcXGQrKVxcYi9nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGVkQ29tcG9uZW50cy5sZW5ndGggPj0gMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudHMgPSBbcGFyc2VSR0IobWF0Y2hlZENvbXBvbmVudHNbMF0pIHx8IDAsIHBhcnNlUkdCKG1hdGNoZWRDb21wb25lbnRzWzFdKSB8fCAwLCBwYXJzZVJHQihtYXRjaGVkQ29tcG9uZW50c1syXSkgfHwgMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50TmFtZXMgPSBbJ3InLCAnZycsICdiJ107XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgZmFpbCgnUkdCIGNvbG9yIHBhcmFtZXRlcnMgY2Fubm90IGJlIHBhcnNlZDogJyArIG1hdGNoZWRTdHJpbmcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoZWRDb21wb25lbnRzLmxlbmd0aCA+PSA0KSBhbHBoYSA9IE1hdGgubWluKE1hdGgubWF4KDAsIHBhcnNlRmxvYXQobWF0Y2hlZENvbXBvbmVudHNbM10pKSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH0gLy8gb3RoZXIgY2FzZXMgdG8gYmUgYWRkZWQgbGF0ZXJcbiAgICAgICAgICAgICAgICB9KSg8c3RyaW5nPmFyZ3VtZW50c1swXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIERldGVybWluZSBNb2RlIChPbmx5IHJnYiBzdXBwb3J0ZWQgc28gZmFyKVxuICAgICAgICAgICAgdGhpcy5tb2RlID0gKGNvbXBvbmVudE5hbWVzLmxlbmd0aCA/IGNvbXBvbmVudE5hbWVzIDogY29tcG9uZW50TmFtZXMgPSAoY29tcG9uZW50TmFtZXMgPSBbJ3InLCAnZycsICdiJ10pKS5qb2luKFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5tb2RlID09PSAncmdiJykgY29tcG9uZW50cyA9IDxudW1iZXJbXT5bIChpc051bWJlcihyKSA/IHIgOiBjb21wb25lbnRzWzBdIHx8IDApLCAoaXNOdW1iZXIoZykgPyBnIDogY29tcG9uZW50c1sxXSB8fCAwKSwgKGlzTnVtYmVyKGIpID8gYiA6IGNvbXBvbmVudHNbMl0gfHwgMCkgXTtcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50cyA9IGNvbXBvbmVudHMsIHRoaXMuY29tcG9uZW50TmFtZXMgPSBjb21wb25lbnROYW1lcywgdGhpcy5hbHBoYSA9IGFscGhhO1xuICAgICAgICB9XG5cbiAgICAgICAgZ2V0Q29tcG9uZW50KGlkOiBzdHJpbmcgfCBudW1iZXIpOiBQYXJzZWRWYWx1ZSB7XG4gICAgICAgICAgICBsZXQgaW5kZXg6IG51bWJlciA9IHBhcnNlSW50KCg8c3RyaW5nPmlkKSk7XG4gICAgICAgICAgICBpZiAoaXNOYU4oaW5kZXgpICYmIGlzU3RyaW5nKGlkKSkgaW5kZXggPSAodGhpcy5jb21wb25lbnROYW1lcyB8fCBbJ3InLCAnZycsICdiJ10pLmluZGV4T2YoKDxzdHJpbmc+aWQpLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcG9uZW50c1tpbmRleF07XG4gICAgICAgIH1cblxuICAgICAgICBnZXRDb21wb25lbnRzKCk6IFBhcnNlZFZhbHVlW10ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcG9uZW50cztcbiAgICAgICAgfVxuXG4gICAgICAgIHNldENvbXBvbmVudHMoe3IgPSB0aGlzLmdldENvbXBvbmVudCgncicpLCBnID0gdGhpcy5nZXRDb21wb25lbnQoJ2cnKSwgYiA9IHRoaXMuZ2V0Q29tcG9uZW50KCdiJykgfTogeyByOiBQYXJzYWJsZVZhbHVlLCBnOiBQYXJzYWJsZVZhbHVlLCBiOiBQYXJzYWJsZVZhbHVlIH0pIHtcbiAgICAgICAgICAgIHIgPSBQYXJzZS5yZ2IociksIGcgPSBQYXJzZS5yZ2IoZyksIGIgPSBQYXJzZS5yZ2IoYik7XG4gICAgICAgICAgICBpZiAodGhpcy5jb21wb25lbnRzWzBdID09PSByICYmIHRoaXMuY29tcG9uZW50c1syXSA9PT0gZyAmJiB0aGlzLmNvbXBvbmVudHNbMV0gPT09IGIpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIC8qIENoYW5nZWQgKi8gdGhpcy5jb21wb25lbnRzID0gW3IsIGcsIGJdLCB0aGlzLnB1Ymxpc2godGhpcywgJ2NvbXBvbmVudHMtY2hhbmdlZCcpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIC8vIGV4cG9ydCBkZWNsYXJlIGludGVyZmFjZSBDb2xvckNvbnN0cnVjdG9yIHtcbiAgICAvLyAgICAgbmV3IChjb2xvclNwZWNpZmljYXRpb24/OiBzdHJpbmd8Q29sb3JDb25zdHJ1Y3RvclBhcmFtZXRlcnMpIDogQ29sb3I7XG4gICAgLy8gfVxufVxuXG4vLyBleHBvcnQgZGVjbGFyZSB0eXBlIE5lcmR5Q29sb3JNb2R1bGUgPSB7XG4vLyAgICAgQ29sb3I6IE5lcmR5Q29sb3IuQ29sb3I7XG4vLyAgICAgVXRpbDogTmVyZHlDb2xvci5VdGlscztcbi8vIH1cblxuLy8gZXhwb3J0IGRlY2xhcmUgaW50ZXJmYWNlIE5lcmR5Q29sb3JNb2R1bGVDb25zdHJ1Y3RvciB7XG4vLyAgICAgQ29sb3I6IE5lcmR5Q29sb3IuQ29sb3I7XG4vLyAgICAgVXRpbDogTmVyZHlDb2xvci5VdGlscztcbi8vIH1cblxuZXhwb3J0IGRlY2xhcmUgdHlwZSBOZXJkeUNvbG9yTW9kdWxlID0geyBDb2xvcjogbmV3IChjb2xvclNwZWNpZmljYXRpb24/OiBDb2xvckNvbnN0cnVjdG9yUGFyYW1ldGVyc3xzdHJpbmd8dW5kZWZpbmVkKSA9PiBOZXJkeUNvbG9yLkNvbG9yLCBVdGlsczogTmVyZHlDb2xvci5VdGlscyB9O1xuZXhwb3J0IGRlY2xhcmUgdHlwZSBOZXJkeUNvbG9yRXhwb3J0cyA9IHsgZGVmYXVsdDpOZXJkeUNvbG9yTW9kdWxlIH07XG5cblxuXG4vLyBleHBvcnQgZGVmYXVsdCBOZXJkeUNvbG9yOyJdfQ==